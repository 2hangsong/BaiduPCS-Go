(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["download"],{"0a49":function(t,e,s){var a=s("9b43"),n=s("626a"),i=s("4bf8"),o=s("9def"),r=s("cd1c");t.exports=function(t,e){var s=1==t,l=2==t,c=3==t,d=4==t,u=6==t,p=5==t||u,_=e||r;return function(e,r,m){for(var h,v,f=i(e),g=n(f),w=a(r,m,3),b=o(g.length),y=0,k=s?_(e,b):l?_(e,0):void 0;b>y;y++)if((p||y in g)&&(h=g[y],v=w(h,y,f),t))if(s)k[y]=v;else if(v)switch(t){case 3:return!0;case 5:return h;case 6:return y;case 2:k.push(h)}else if(d)return!1;return u?-1:c||d?d:k}}},1169:function(t,e,s){var a=s("2d95");t.exports=Array.isArray||function(t){return"Array"==a(t)}},"20d6":function(t,e,s){"use strict";var a=s("5ca1"),n=s("0a49")(6),i="findIndex",o=!0;i in[]&&Array(1)[i](function(){o=!1}),a(a.P+a.F*o,"Array",{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s("9c6c")(i)},3971:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",[s("Sider",{style:{background:"#fff"},attrs:{"hide-trigger":""}},[s("Menu",{attrs:{theme:"light",width:"auto","open-names":["1"],"active-name":t.select_menu_name},on:{"on-select":t.getMenuName}},[s("Submenu",{attrs:{name:"1"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("我的下载")],1),s("MenuItem",{attrs:{name:"1-1"}},[t._v("正在下载")]),s("MenuItem",{attrs:{name:"1-2"}},[t._v("已经完成")])],2),s("Submenu",{attrs:{name:"2"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-cloud-upload"}}),t._v("我的上传")],1),s("MenuItem",{attrs:{name:"2-1"}},[t._v("正在上传")]),s("MenuItem",{attrs:{name:"2-2"}},[t._v("已经完成")])],2),s("Submenu",{attrs:{name:"3"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-link"}}),t._v("离线下载")],1),s("MenuItem",{attrs:{name:"3-1"}},[t._v("正在下载")]),s("MenuItem",{attrs:{name:"3-2"}},[t._v("已经完成")])],2)],1)],1),s("Layout",{style:{padding:"0 24px 24px"}},[s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.downloading,itype:1,istatus:2}}),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.pending_download,itype:1,istatus:1}}),"1-2"===t.select_menu_name?s("v-finished",{attrs:{items:t.globals.downloaded,itype:1}}):t._e(),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.uploading,itype:2,istatus:2}}),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.pending_upload,itype:2,istatus:1}}),"2-2"===t.select_menu_name?s("v-finished",{attrs:{items:t.globals.uploaded,itype:2}}):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:"3-1"===t.select_menu_name,expression:"select_menu_name === '3-1'"}]},[s("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[s("Row",[s("Col",{attrs:{span:"6"}},[t._v("任务名")]),s("Col",{attrs:{span:"2"}},[t._v("大小")]),s("Col",{attrs:{span:"7"}},[t._v("进度")]),s("Col",{attrs:{span:"3"}},[t._v("任务状态")]),s("Col",{attrs:{span:"4"}},[t._v("开始时间")]),s("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloading,function(e){return s("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[s("Row",[s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),s("Col",{attrs:{span:"7"}},[s("Progress",{attrs:{percent:e.percent,status:"active"}})],1),s("Col",{attrs:{span:"3"}},[t._v(t._s(e.status_text))]),s("Col",{attrs:{span:"4"}},[t._v(t._s(e.stime))]),s("Col",{attrs:{span:"2"}},[s("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(s){t.deleteTask(e)}}})],1)],1)],1)})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:"3-2"===t.select_menu_name,expression:"select_menu_name === '3-2'"}]},[s("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[s("Row",[s("Col",{attrs:{span:"6"}},[t._v("任务名")]),s("Col",{attrs:{span:"2"}},[t._v("任务状态")]),s("Col",{attrs:{span:"2"}},[t._v("大小")]),s("Col",{attrs:{span:"8"}},[t._v("路径")]),s("Col",{attrs:{span:"4"}},[t._v("完成时间")]),s("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloaded,function(e){return s("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[s("Row",[s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.status_text))]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap"},attrs:{title:e.path,span:"8"}},[t._v(t._s(e.path))]),s("Col",{attrs:{span:"4"}},[t._v(t._s(e.ftime))]),s("Col",{attrs:{span:"2"}},[s("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(s){t.deleteTask(e)}}})],1)],1)],1)})],2)],1)],1)},n=[],i=(s("96cf"),s("3040")),o=(s("7f7f"),s("20d6"),s("7514"),s("28a5"),s("a481"),s("c93e")),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Modal",{attrs:{draggable:"",title:"任务详情",width:800},model:{value:t.modalDetailFlag,callback:function(e){t.modalDetailFlag=e},expression:"modalDetailFlag"}},[s("Row",[s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("任务ID")])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("任务状态")])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("速度")])]),s("Col",{attrs:{span:"12"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("错误信息")])])],1),s("div",{staticStyle:{height:"60vh","overflow-y":"auto"}},t._l(t.taskDetail,function(e){return s("Row",[s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.id))])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.status))])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.speed)+"/s")])]),s("Col",{attrs:{span:"12"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.error))])])],1)})),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"info"},on:{click:function(e){t.modalDetailFlag=!1}}},[t._v("确认")])],1)],1),t._l(t.items,function(e){return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name)+"\n      "),s("Divider",{attrs:{type:"vertical"}}),1===t.istatus?s("span",[1===t.itype?[t._v("等待下载...")]:t._e(),2===t.itype?[t._v("等待上传...")]:t._e()],2):s("span",[t._v(t._s(e.total_size))])],1),3!==t.istatus?s("Row",[s("Col",{attrs:{span:"11"}},[s("Progress",{attrs:{percent:e.percent,status:"active"}})],1),1===t.itype&&2===t.istatus?s("Col",{staticClass:"c-action-group",attrs:{span:"3"}},[e.is_pause?s("Button",{attrs:{size:"small",type:"success",ghost:""},on:{click:function(s){t.switchDownloadStatus(e)}}},[s("Icon",{attrs:{type:"md-play"}})],1):s("Button",{attrs:{size:"small",type:"warning",ghost:""},on:{click:function(s){t.switchDownloadStatus(e)}}},[s("Icon",{attrs:{type:"md-pause"}})],1),s("Button",{attrs:{size:"small",type:"error",ghost:""},on:{click:function(s){t.cancelTask(e)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("Button",{attrs:{size:"small",type:"info",ghost:""},on:{click:function(s){t.detailTask(e)}}},[s("Icon",{attrs:{type:"md-barcode"}})],1)],1):t._e(),s("Col",{attrs:{span:"10"}},[s("span",[t._v("速度: "+t._s(e.speed)+"/s")]),s("Divider",{attrs:{type:"vertical"}}),1===t.itype?s("span",[t._v("已经下载: "+t._s(e.download_size))]):t._e(),2===t.itype?s("span",[t._v("已经上传: "+t._s(e.uploaded_size))]):t._e(),s("Divider",{attrs:{type:"vertical"}}),s("span",[t._v("已用时间: "+t._s(e.time_used))]),s("Divider",{attrs:{type:"vertical"}}),s("span",[t._v("预计还需: "+t._s(e.time_left))])],1)],1):t._e()],1)})],2)},l=[],c=s("c276"),d={name:"v-download-process-item",props:["items","itype","istatus"],data:function(){return{modalDetailFlag:!1,taskDetail:[]}},methods:{switchDownloadStatus:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s=e.is_pause?"resume":"pause",t.next=3,$axios.get("download?method=".concat(s,"&id=").concat(e.LastID)).catch(this.error);case 3:a=t.sent,0===a.data.code?this.$Message.success("操作成功"):this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),cancelTask:function(t){var e=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var s=Object(i["a"])(regeneratorRuntime.mark(function s(){var a;return regeneratorRuntime.wrap(function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,$axios.get("download?method=cancel&id=".concat(t.LastID)).catch(e.error);case 2:a=s.sent,0===a.data.code?e.$Message.success("操作成功"):e.$Message.error({content:a.data.msg,duration:10,closable:!0});case 4:case"end":return s.stop()}},s,this)}));return function(){return s.apply(this,arguments)}}()})},getTaskStatus:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,a,n,i,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("download?method=status&id=".concat(e)).catch(this.error);case 2:if(s=t.sent,0===s.data.code){for(this.taskDetail=[],a=s.data.data,n=0;n<a.length;n++)i="","<nil>"!==a[n].error&&(i=a[n].error),this.taskDetail.push({id:a[n].id,status:a[n].status,speed:c["a"].bytesToSize(a[n].speed),error:i});this.modalDetailFlag&&setTimeout(function(){return o.getTaskStatus(e)},1e3)}else this.$Message.info({content:s.data.msg,duration:10,closable:!0}),this.modalDetailFlag=!1;case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),detailTask:function(t){this.getTaskStatus(t.LastID),this.modalDetailFlag=!0}}},u=d,p=s("2877"),_=Object(p["a"])(u,r,l,!1,null,null,null);_.options.__file="DownloadProcessItem.vue";var m=_.exports,h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"child-finished"},t._l(t.items,function(e){return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name)+"\n      "),s("Divider",{attrs:{type:"vertical"}}),s("span",[t._v(t._s(e.total_size))])],1),s("Row",[s("Col",{attrs:{span:"4"}},[s("Progress",{attrs:{percent:e.percent,status:"active"}})],1),s("Col",{attrs:{span:"20"}},[s("span",[t._v("平均速度: "+t._s(e.avg_speed)+"/s")]),s("Divider",{attrs:{type:"vertical"}}),s("span",[t._v("已用时间: "+t._s(e.time_used))]),s("Divider",{attrs:{type:"vertical"}}),1===t.itype?s("span",[t._v("保存本地")]):t._e(),2===t.itype?s("span",[t._v("保存云端")]):t._e(),t._v(" \n        "),s("span",[t._v("路径: "+t._s(e.save_path))]),s("Divider",{attrs:{type:"vertical"}}),1===t.itype?s("Button",{attrs:{type:"success",size:"small",ghost:""},on:{click:function(s){t.openFolder(e.save_path)}}},[s("Icon",{attrs:{type:"ios-redo"}}),t._v("打开下载目录\n        ")],1):t._e()],1)],1)],1)}))},v=[],f=(s("c5f6"),{name:"v-finished",props:{items:Array,itype:Number},methods:{openFolder:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("local_file?method=open_folder&path=".concat(encodeURIComponent(e))).catch(this.error);case 2:s=t.sent,0!==s.data.code&&this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),g=f,w=Object(p["a"])(g,h,v,!1,null,null,null);w.options.__file="Finished.vue";var b=w.exports,y=s("db49"),k=s("2f62"),D={name:"v-download",data:function(){return{select_menu_name:"1-1",base_url:y["a"].base_url,ws_url:y["a"].ws_url,modalDetailFlag:!1,offline_downloaded:[],offline_downloading:[]}},computed:Object(o["a"])({},Object(k["c"])(["globals","websocket"])),components:{VDownloadProcessItem:m,VFinished:b},methods:Object(o["a"])({},Object(k["b"])(["initWS"]),{initWebSocket:function(){null===this.websocket&&this.initWS(),this.websocket.onmessage=this.receiveData},receiveData:function(t){var e=JSON.parse(t.data);0!==e.code&&this.$Message.error({content:e.msg,duration:10,closable:!0});var s=0,a={},n=JSON.parse(e.data.replace(/\\/g,"/"));if(2===e.type)switch(e.status){case 1:var i=n.path.split("/");this.globals.downloading.push({LastID:n.LastID,path:n.path,name:i.pop(),speed:"0KB",avg_speed:"0KB",time_used:"0s",download_size:"0KB",total_size:"--KB",time_left:"--s",percent:0,is_pause:!1,status:e.status});break;case 2:this.removeDownloadingList(n.path);break;case 5:a=this.globals.downloading.find(function(t){return t.LastID===n.LastID}),a?a.is_pause||(a.speed=n.speed,a.avg_speed=n.avg_speed,a.time_used=n.time_used,a.download_size=n.download_size,a.total_size=n.total_size,a.time_left=n.time_left,a.percent=n.percent,a.status=e.status):(n.status=e.status,this.globals.downloading.push(n));break;case 6:a=this.globals.downloading.find(function(t){return t.LastID===n.LastID}),a.is_pause=!0,a.speed="0KB",a.avg_speed="0KB",a.time_left="--s",a.status=e.status;break;case 7:a=this.globals.downloading.find(function(t){return t.LastID===n.LastID}),a.is_pause=!1,a.status=e.status;break;case 8:s=this.getIndexFromArray(this.globals.downloading,n.LastID),this.globals.downloading.splice(s,1);break;case 9:s=this.globals.downloading.findIndex(function(t){return t.LastID===n.LastID}),s>=0&&(a=this.globals.downloading[s],this.globals.downloaded.push({LastID:a.LastID,path:a.path,name:a.name,speed:a.speed,avg_speed:a.avg_speed,time_used:a.time_used,download_size:a.download_size,total_size:a.total_size,time_left:"0s",percent:100,status:e.status,save_path:n.savePath}),this.globals.downloading.splice(s,1));break}if(3===e.type)switch(e.status){case 1:var o=n.path.split("/");this.globals.uploading.push({LastID:n.LastID,path:n.path,name:o.pop(),speed:"0KB",avg_speed:"0KB",time_used:"0s",uploaded_size:"0KB",total_size:"--KB",time_left:"--s",percent:0,is_pause:!1,status:e.status});break;case 2:break;case 3:s=this.globals.uploading.findIndex(function(t){return t.LastID===n.LastID}),a=this.globals.uploading[s],a.percent=100,a.status=e.status,a.save_path=n.savePath,this.globals.uploaded.push(a),this.globals.uploading.splice(s,1);break;case 4:a=this.globals.uploading.find(function(t){return t.LastID===n.LastID}),a.speed=n.speed,a.avg_speed=n.avg_speed,a.time_used=n.time_used,a.uploaded_size=n.uploaded_size,a.total_size=n.total_size,a.time_left=n.time_left,a.percent=n.percent,a.status=e.status;break;case 5:s=this.globals.uploading.findIndex(function(t){return t.LastID===n.LastID}),a=this.globals.uploading[s],this.globals.uploaded.push({LastID:a.LastID,path:a.path,name:a.name,speed:a.speed,avg_speed:a.avg_speed,time_used:a.time_used,uploaded_size:a.uploaded_size,total_size:a.total_size,time_left:"0s",percent:100,status:e.status,save_path:n.savePath}),this.globals.uploading.splice(s,1);break}},getMenuName:function(t){this.select_menu_name=t,"3-1"!==t&&"3-2"!==t||this.getOfflineTask()},removeDownloadingList:function(t){for(var e=0;e<this.globals.downloading.length;e++)if(t===this.globals.downloading[e].path){this.globals.downloading.splice(e,1);break}},deleteTask:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s="delete",0!==e.status&&(s="cancel"),t.next=4,$axios.get("offline_download?method=".concat(s,"&id=").concat(e.taskid)).catch(this.error);case 4:a=t.sent,0===a.data.code?(this.$Message.success("删除成功"),this.getOfflineTask()):this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getOfflineTask:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,s,a,n,i,o,r,l=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("offline_download?method=list").catch(this.error);case 2:if(e=t.sent,0===e.data.code){for(s=e.data.data,a=[],n=[],i=0;i<s.length;i++)o=s[i],0===o.Status?a.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:c["a"].bytesToSize(o.FileSize),finished_size:c["a"].bytesToSize(o.FinishedSize),ftime:c["a"].formatDateTime(1e3*o.FinishTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}):(r=(1*o.FinishedSize/(1*o.FileSize)*100).toFixed(2),n.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:c["a"].bytesToSize(o.FileSize),finished_size:c["a"].bytesToSize(o.FinishedSize),percent:1*r,stime:c["a"].formatDateTime(1e3*o.StartTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}));this.offline_downloaded=a,this.offline_downloading=n,n.length>0&&setTimeout(function(){return l.getOfflineTask()},1e3)}else this.$Message.error({content:e.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),created:function(){this.initWebSocket()}},x=D,z=Object(p["a"])(x,a,n,!1,null,null,null);z.options.__file="Download.vue";e["default"]=z.exports},7514:function(t,e,s){"use strict";var a=s("5ca1"),n=s("0a49")(5),i="find",o=!0;i in[]&&Array(1)[i](function(){o=!1}),a(a.P+a.F*o,"Array",{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s("9c6c")(i)},a481:function(t,e,s){s("214f")("replace",2,function(t,e,s){return[function(a,n){"use strict";var i=t(this),o=void 0==a?void 0:a[e];return void 0!==o?o.call(a,i,n):s.call(String(i),a,n)},s]})},cd1c:function(t,e,s){var a=s("e853");t.exports=function(t,e){return new(a(t))(e)}},e853:function(t,e,s){var a=s("d3f4"),n=s("1169"),i=s("2b4c")("species");t.exports=function(t){var e;return n(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!n(e.prototype)||(e=void 0),a(e)&&(e=e[i],null===e&&(e=void 0))),void 0===e?Array:e}}}]);
//# sourceMappingURL=download.3bb7a394.js.map