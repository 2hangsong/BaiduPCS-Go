(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["download"],{"11e9":function(t,e,a){var s=a("52a7"),n=a("4630"),i=a("6821"),o=a("6a99"),r=a("69a8"),c=a("c69a"),l=Object.getOwnPropertyDescriptor;e.f=a("9e1e")?l:function(t,e){if(t=i(t),e=o(e,!0),c)try{return l(t,e)}catch(t){}if(r(t,e))return n(!s.f.call(t,e),t[e])}},3971:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-download"},[a("Sider",{attrs:{"hide-trigger":""}},[a("Menu",{attrs:{theme:"light",width:"auto","open-names":["1"],"active-name":t.select_menu_name},on:{"on-select":t.getMenuName}},[a("Submenu",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("我的下载")],1),a("MenuItem",{attrs:{name:"1-1"}},[t._v("正在下载")]),a("MenuItem",{attrs:{name:"1-2"}},[t._v("已经完成")])],2),a("Submenu",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-cloud-upload"}}),t._v("我的上传")],1),a("MenuItem",{attrs:{name:"2-1"}},[t._v("正在上传")]),a("MenuItem",{attrs:{name:"2-2"}},[t._v("已经完成")])],2),a("Submenu",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-link"}}),t._v("离线下载")],1),a("MenuItem",{attrs:{name:"3-1"}},[t._v("正在下载")]),a("MenuItem",{attrs:{name:"3-2"}},[t._v("已经完成")])],2)],1)],1),a("div",{staticClass:"p-main"},["1-1"===t.select_menu_name&&(t.globals.downloading.length||t.globals.pending_download.length)?a("div",{staticStyle:{"margin-bottom":"8px"}},[a("Button",{attrs:{size:"small",type:"error",ghost:""},on:{click:t.cancelAll}},[t._v("全部取消")])],1):t._e(),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.downloading,itype:1,istatus:2}}),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.pending_download,itype:1,istatus:1}}),"1-2"===t.select_menu_name?a("v-finished",{attrs:{items:t.globals.downloaded,itype:1}}):t._e(),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.uploading,itype:2,istatus:2}}),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.pending_upload,itype:2,istatus:1}}),"2-2"===t.select_menu_name?a("v-finished",{attrs:{items:t.globals.uploaded,itype:2}}):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:"3-1"===t.select_menu_name,expression:"select_menu_name === '3-1'"}]},[a("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[a("Row",[a("Col",{attrs:{span:"6"}},[t._v("任务名")]),a("Col",{attrs:{span:"2"}},[t._v("大小")]),a("Col",{attrs:{span:"7"}},[t._v("进度")]),a("Col",{attrs:{span:"3"}},[t._v("任务状态")]),a("Col",{attrs:{span:"4"}},[t._v("开始时间")]),a("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloading,function(e){return a("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[a("Row",[a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),a("Col",{attrs:{span:"7"}},[a("Progress",{attrs:{percent:e.percent,status:"active"}})],1),a("Col",{attrs:{span:"3"}},[t._v(t._s(e.status_text))]),a("Col",{attrs:{span:"4"}},[t._v(t._s(e.stime))]),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(a){t.deleteTask(e)}}})],1)],1)],1)})],2),a("div",{directives:[{name:"show",rawName:"v-show",value:"3-2"===t.select_menu_name,expression:"select_menu_name === '3-2'"}]},[a("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[a("Row",[a("Col",{attrs:{span:"6"}},[t._v("任务名")]),a("Col",{attrs:{span:"2"}},[t._v("任务状态")]),a("Col",{attrs:{span:"2"}},[t._v("大小")]),a("Col",{attrs:{span:"8"}},[t._v("路径")]),a("Col",{attrs:{span:"4"}},[t._v("完成时间")]),a("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloaded,function(e){return a("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[a("Row",[a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.status_text))]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap"},attrs:{title:e.path,span:"8"}},[t._v(t._s(e.path))]),a("Col",{attrs:{span:"4"}},[t._v(t._s(e.ftime))]),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(a){t.deleteTask(e)}}})],1)],1)],1)})],2)],1)],1)},n=[];function i(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function o(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){return i(t)||o(t)||r()}a("96cf");var l=a("3040"),u=a("c93e"),p=(a("cadf"),a("551c"),a("097d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"child-download-items"},[a("Modal",{attrs:{draggable:"",title:"任务详情",width:800},model:{value:t.modalDetailFlag,callback:function(e){t.modalDetailFlag=e},expression:"modalDetailFlag"}},[a("Row",[a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("任务ID")])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("任务状态")])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("速度")])]),a("Col",{attrs:{span:"12"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("错误信息")])])],1),a("div",{staticStyle:{height:"60vh","overflow-y":"auto"}},t._l(t.taskDetail,function(e){return a("Row",[a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.id))])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.status))])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.speed)+"/s")])]),a("Col",{attrs:{span:"12"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.error))])])],1)})),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"info"},on:{click:function(e){t.modalDetailFlag=!1}}},[t._v("确认")])],1)],1),a("div",{staticClass:"items-list"},t._l(t.items,function(e){return a("div",{staticClass:"item"},[a("h3",{staticClass:"i-title"},[a("span",[t._v(t._s(e.name))]),1===t.istatus?a("span",[1===t.itype?[t._v("等待下载...")]:t._e(),2===t.itype?[t._v("等待上传...")]:t._e()],2):a("span",[t._v(t._s(e.total_size))])]),a("div",{staticClass:"i-body"},[a("div",{staticClass:"b-progress"},[a("div",{staticClass:"v-progress",class:{success:e.percent>=100}},[a("div",{staticClass:"p-bar"},[a("div",{staticClass:"b-fg",style:"width: "+e.percent+"%;"})]),a("div",{staticClass:"p-text"},[t._v(t._s(e.percent)+"%")])])]),1===t.itype&&2===t.istatus?a("div",{staticClass:"b-actions"},[e.is_pause?a("button",{staticClass:"ivu-btn ivu-btn-warning ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(a){t.switchDownloadStatus(e)}}},[a("Icon",{attrs:{type:"md-play"}})],1):a("button",{staticClass:"ivu-btn ivu-btn-warning ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(a){t.switchDownloadStatus(e)}}},[a("Icon",{attrs:{type:"md-pause"}})],1),a("button",{staticClass:"ivu-btn ivu-btn-error ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(a){t.cancelTask(e)}}},[a("Icon",{attrs:{type:"md-close"}})],1),a("button",{staticClass:"ivu-btn ivu-btn-info ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(a){t.detailTask(e)}}},[a("Icon",{attrs:{type:"md-barcode"}})],1)]):t._e(),a("div",{staticClass:"b-info"},[a("span",[t._v("速度: "+t._s(e.speed)+"/s")]),1===t.itype?a("span",[t._v("已经下载: "+t._s(e.download_size))]):t._e(),2===t.itype?a("span",[t._v("已经上传: "+t._s(e.uploaded_size))]):t._e(),a("span",[t._v("已用时间: "+t._s(e.time_used))]),a("span",[t._v("预计还需: "+t._s(e.time_left))])])])])}))],1)}),d=[],m=a("c276"),_={name:"v-download-process-item",data:function(){return{modalDetailFlag:!1,taskDetail:[]}},props:["items","itype","istatus"],methods:{switchDownloadStatus:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.is_pause?"resume":"pause",t.next=3,$axios.get("download?method=".concat(a,"&id=").concat(e.LastID)).catch(this.error);case 3:s=t.sent,0===s.data.code?this.$Message.success("操作成功"):this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),cancelTask:function(t){var e=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var a=Object(l["a"])(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,$axios.get("download?method=cancel&id=".concat(t.LastID)).catch(e.error);case 2:s=a.sent,0===s.data.code?e.$Message.success("操作成功"):e.$Message.error({content:s.data.msg,duration:10,closable:!0});case 4:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}()})},getTaskStatus:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e){var a,s,n,i,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("download?method=status&id=".concat(e)).catch(this.error);case 2:if(a=t.sent,0===a.data.code){for(this.taskDetail=[],s=a.data.data,n=0;n<s.length;n++)i="","<nil>"!==s[n].error&&(i=s[n].error),this.taskDetail.push({id:s[n].id,status:s[n].status,speed:m["a"].bytesToSize(s[n].speed),error:i});this.modalDetailFlag&&setTimeout(function(){return o.getTaskStatus(e)},1e3)}else this.$Message.info({content:a.data.msg,duration:10,closable:!0}),this.modalDetailFlag=!1;case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),detailTask:function(t){this.getTaskStatus(t.LastID),this.modalDetailFlag=!0}}},f=_,v=a("2877"),h=Object(v["a"])(f,p,d,!1,null,null,null);h.options.__file="DownloadProcessItem.vue";var g=h.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"child-finished"},[a("div",{staticClass:"items-list"},t._l(t.items,function(e){return a("div",{staticClass:"item"},[a("h3",{staticClass:"i-title"},[a("span",[t._v(t._s(e.name))]),a("span",[t._v(t._s(e.total_size))])]),a("div",{staticClass:"i-body"},[a("Icon",{attrs:{type:"md-checkmark-circle",size:"24",color:"#19be6b"}}),a("span",[t._v("平均速度: "+t._s(e.avg_speed)+"/s")]),a("span",[t._v("已用时间: "+t._s(e.time_used))]),1===t.itype?a("span",[t._v("保存本地")]):t._e(),2===t.itype?a("span",[t._v("保存云端")]):t._e(),a("span",[t._v("路径: "+t._s(e.save_path))]),1===t.itype?a("button",{staticClass:"ivu-btn ivu-btn-success ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(a){t.openFolder(e.save_path)}}},[t._v("打开下载目录")]):t._e()],1)])}))])},w=[],y=(a("c5f6"),{name:"v-finished",props:{items:Array,itype:Number},methods:{openFolder:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e){var a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("local_file?method=open_folder&path=".concat(encodeURIComponent(e))).catch(this.error);case 2:a=t.sent,0!==a.data.code&&this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),x=y,k=Object(v["a"])(x,b,w,!1,null,null,null);k.options.__file="Finished.vue";var C=k.exports,S=a("db49"),I=a("2f62"),T={name:"v-download",data:function(){return{select_menu_name:"1-1",base_url:S["a"].base_url,ws_url:S["a"].ws_url,modalDetailFlag:!1,offline_downloaded:[],offline_downloading:[]}},computed:Object(u["a"])({},Object(I["c"])(["globals","websocket"])),components:{VDownloadProcessItem:g,VFinished:C},methods:Object(u["a"])({},Object(I["b"])(["initWS"]),{initWebSocket:function(){null===this.websocket&&this.initWS()},getMenuName:function(t){this.select_menu_name=t,"3-1"!==t&&"3-2"!==t||this.getOfflineTask()},deleteTask:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a="delete",0!==e.status&&(a="cancel"),t.next=4,$axios.get("offline_download?method=".concat(a,"&id=").concat(e.taskid)).catch(this.error);case 4:s=t.sent,0===s.data.code?(this.$Message.success("删除成功"),this.getOfflineTask()):this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getOfflineTask:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,a,s,n,i,o,r,c=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("offline_download?method=list").catch(this.error);case 2:if(e=t.sent,0===e.data.code){for(a=e.data.data,s=[],n=[],i=0;i<a.length;i++)o=a[i],0===o.Status?s.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:m["a"].bytesToSize(o.FileSize),finished_size:m["a"].bytesToSize(o.FinishedSize),ftime:m["a"].formatDateTime(1e3*o.FinishTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}):(r=(1*o.FinishedSize/(1*o.FileSize)*100).toFixed(2),n.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:m["a"].bytesToSize(o.FileSize),finished_size:m["a"].bytesToSize(o.FinishedSize),percent:1*r,stime:m["a"].formatDateTime(1e3*o.StartTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}));this.offline_downloaded=s,this.offline_downloading=n,n.length>0&&setTimeout(function(){return c.getOfflineTask()},1e3)}else this.$Message.error({content:e.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),cancelAll:function(){var t=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){var a,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=c(t.globals.downloading.map(function(t){return t.LastID})).concat(c(t.globals.pending_download.map(function(t){return t.LastID}))),n=0;case 2:if(!(n<a.length)){e.next=14;break}case 3:return e.next=5,m["a"].sleep();case 5:return e.next=7,$axios.get("download?method=cancel&id=".concat(a[n])).catch(t.error);case 7:s=e.sent;case 8:if(0!==s.data.code){e.next=3;break}case 9:return e.next=11,m["a"].sleep();case 11:n++,e.next=2;break;case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()})}}),created:function(){this.initWebSocket()}},O=T,z=Object(v["a"])(O,s,n,!1,null,null,null);z.options.__file="Download.vue";e["default"]=z.exports},"52a7":function(t,e){e.f={}.propertyIsEnumerable},"5dbc":function(t,e,a){var s=a("d3f4"),n=a("8b97").set;t.exports=function(t,e,a){var i,o=e.constructor;return o!==a&&"function"==typeof o&&(i=o.prototype)!==a.prototype&&s(i)&&n&&n(t,i),t}},"8b97":function(t,e,a){var s=a("d3f4"),n=a("cb7c"),i=function(t,e){if(n(t),!s(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,s){try{s=a("9b43")(Function.call,a("11e9").f(Object.prototype,"__proto__").set,2),s(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,a){return i(t,a),e?t.__proto__=a:s(t,a),t}}({},!1):void 0),check:i}},9093:function(t,e,a){var s=a("ce10"),n=a("e11e").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},aa77:function(t,e,a){var s=a("5ca1"),n=a("be13"),i=a("79e5"),o=a("fdef"),r="["+o+"]",c="​",l=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),p=function(t,e,a){var n={},r=i(function(){return!!o[t]()||c[t]()!=c}),l=n[t]=r?e(d):o[t];a&&(n[a]=l),s(s.P+s.F*r,"String",n)},d=p.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=p},c5f6:function(t,e,a){"use strict";var s=a("7726"),n=a("69a8"),i=a("2d95"),o=a("5dbc"),r=a("6a99"),c=a("79e5"),l=a("9093").f,u=a("11e9").f,p=a("86cc").f,d=a("aa77").trim,m="Number",_=s[m],f=_,v=_.prototype,h=i(a("2aeb")(v))==m,g="trim"in String.prototype,b=function(t){var e=r(t,!1);if("string"==typeof e&&e.length>2){e=g?e.trim():d(e,3);var a,s,n,i=e.charCodeAt(0);if(43===i||45===i){if(a=e.charCodeAt(2),88===a||120===a)return NaN}else if(48===i){switch(e.charCodeAt(1)){case 66:case 98:s=2,n=49;break;case 79:case 111:s=8,n=55;break;default:return+e}for(var o,c=e.slice(2),l=0,u=c.length;l<u;l++)if(o=c.charCodeAt(l),o<48||o>n)return NaN;return parseInt(c,s)}}return+e};if(!_(" 0o1")||!_("0b1")||_("+0x1")){_=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof _&&(h?c(function(){v.valueOf.call(a)}):i(a)!=m)?o(new f(b(e)),a,_):b(e)};for(var w,y=a("9e1e")?l(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;y.length>x;x++)n(f,w=y[x])&&!n(_,w)&&p(_,w,u(f,w));_.prototype=v,v.constructor=_,a("2aba")(s,m,_)}},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);
//# sourceMappingURL=download.8c644c24.js.map