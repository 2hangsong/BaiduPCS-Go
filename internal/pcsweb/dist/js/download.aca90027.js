(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["download"],{3971:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",[a("Sider",{style:{background:"#fff"},attrs:{"hide-trigger":""}},[a("Menu",{attrs:{theme:"light",width:"auto","open-names":["1"],"active-name":t.select_menu_name},on:{"on-select":t.getMenuName}},[a("Submenu",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("我的下载")],1),a("MenuItem",{attrs:{name:"1-1"}},[t._v("正在下载")]),a("MenuItem",{attrs:{name:"1-2"}},[t._v("已经完成")])],2),a("Submenu",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-cloud-upload"}}),t._v("我的上传")],1),a("MenuItem",{attrs:{name:"2-1"}},[t._v("正在上传")]),a("MenuItem",{attrs:{name:"2-2"}},[t._v("已经完成")])],2),a("Submenu",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("Icon",{attrs:{type:"ios-link"}}),t._v("离线下载")],1),a("MenuItem",{attrs:{name:"3-1"}},[t._v("正在下载")]),a("MenuItem",{attrs:{name:"3-2"}},[t._v("已经完成")])],2)],1)],1),a("Layout",{style:{padding:"24px"}},["1-1"===t.select_menu_name&&(t.globals.downloading.length||t.globals.pending_download.length)?a("div",{staticStyle:{"margin-bottom":"8px"}},[a("Button",{attrs:{size:"small",type:"error",ghost:""},on:{click:t.cancelAll}},[t._v("全部取消")])],1):t._e(),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.downloading,itype:1,istatus:2}}),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.pending_download,itype:1,istatus:1}}),"1-2"===t.select_menu_name?a("v-finished",{attrs:{items:t.globals.downloaded,itype:1}}):t._e(),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.uploading,itype:2,istatus:2}}),a("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.pending_upload,itype:2,istatus:1}}),"2-2"===t.select_menu_name?a("v-finished",{attrs:{items:t.globals.uploaded,itype:2}}):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:"3-1"===t.select_menu_name,expression:"select_menu_name === '3-1'"}]},[a("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[a("Row",[a("Col",{attrs:{span:"6"}},[t._v("任务名")]),a("Col",{attrs:{span:"2"}},[t._v("大小")]),a("Col",{attrs:{span:"7"}},[t._v("进度")]),a("Col",{attrs:{span:"3"}},[t._v("任务状态")]),a("Col",{attrs:{span:"4"}},[t._v("开始时间")]),a("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloading,function(e){return a("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[a("Row",[a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),a("Col",{attrs:{span:"7"}},[a("Progress",{attrs:{percent:e.percent,status:"active"}})],1),a("Col",{attrs:{span:"3"}},[t._v(t._s(e.status_text))]),a("Col",{attrs:{span:"4"}},[t._v(t._s(e.stime))]),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(a){t.deleteTask(e)}}})],1)],1)],1)})],2),a("div",{directives:[{name:"show",rawName:"v-show",value:"3-2"===t.select_menu_name,expression:"select_menu_name === '3-2'"}]},[a("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[a("Row",[a("Col",{attrs:{span:"6"}},[t._v("任务名")]),a("Col",{attrs:{span:"2"}},[t._v("任务状态")]),a("Col",{attrs:{span:"2"}},[t._v("大小")]),a("Col",{attrs:{span:"8"}},[t._v("路径")]),a("Col",{attrs:{span:"4"}},[t._v("完成时间")]),a("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloaded,function(e){return a("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[a("Row",[a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.status_text))]),a("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),a("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap"},attrs:{title:e.path,span:"8"}},[t._v(t._s(e.path))]),a("Col",{attrs:{span:"4"}},[t._v(t._s(e.ftime))]),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(a){t.deleteTask(e)}}})],1)],1)],1)})],2)],1)],1)},n=[];function o(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function r(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(t){return o(t)||r(t)||i()}a("96cf");var c=a("3040"),u=a("c93e"),d=(a("cadf"),a("551c"),a("097d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{draggable:"",title:"任务详情",width:800},model:{value:t.modalDetailFlag,callback:function(e){t.modalDetailFlag=e},expression:"modalDetailFlag"}},[a("Row",[a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("任务ID")])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("任务状态")])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("速度")])]),a("Col",{attrs:{span:"12"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v("错误信息")])])],1),a("div",{staticStyle:{height:"60vh","overflow-y":"auto"}},t._l(t.taskDetail,function(e){return a("Row",[a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.id))])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.status))])]),a("Col",{attrs:{span:"4"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.speed)+"/s")])]),a("Col",{attrs:{span:"12"}},[a("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.error))])])],1)})),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"info"},on:{click:function(e){t.modalDetailFlag=!1}}},[t._v("确认")])],1)],1),t._l(t.items,function(e){return a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name)+"\n      "),a("Divider",{attrs:{type:"vertical"}}),1===t.istatus?a("span",[1===t.itype?[t._v("等待下载...")]:t._e(),2===t.itype?[t._v("等待上传...")]:t._e()],2):a("span",[t._v(t._s(e.total_size))])],1),3!==t.istatus?a("Row",[a("Col",{attrs:{span:"11"}},[a("Progress",{attrs:{percent:e.percent,status:"active"}})],1),1===t.itype&&2===t.istatus?a("Col",{staticClass:"c-action-group",attrs:{span:"3"}},[e.is_pause?a("Button",{attrs:{size:"small",type:"success",ghost:""},on:{click:function(a){t.switchDownloadStatus(e)}}},[a("Icon",{attrs:{type:"md-play"}})],1):a("Button",{attrs:{size:"small",type:"warning",ghost:""},on:{click:function(a){t.switchDownloadStatus(e)}}},[a("Icon",{attrs:{type:"md-pause"}})],1),a("Button",{attrs:{size:"small",type:"error",ghost:""},on:{click:function(a){t.cancelTask(e)}}},[a("Icon",{attrs:{type:"md-close"}})],1),a("Button",{attrs:{size:"small",type:"info",ghost:""},on:{click:function(a){t.detailTask(e)}}},[a("Icon",{attrs:{type:"md-barcode"}})],1)],1):t._e(),a("Col",{attrs:{span:"10"}},[a("span",[t._v("速度: "+t._s(e.speed)+"/s")]),a("Divider",{attrs:{type:"vertical"}}),1===t.itype?a("span",[t._v("已经下载: "+t._s(e.download_size))]):t._e(),2===t.itype?a("span",[t._v("已经上传: "+t._s(e.uploaded_size))]):t._e(),a("Divider",{attrs:{type:"vertical"}}),a("span",[t._v("已用时间: "+t._s(e.time_used))]),a("Divider",{attrs:{type:"vertical"}}),a("span",[t._v("预计还需: "+t._s(e.time_left))])],1)],1):t._e()],1)})],2)}),p=[],m=a("c276"),_={name:"v-download-process-item",props:["items","itype","istatus"],data:function(){return{modalDetailFlag:!1,taskDetail:[]}},methods:{switchDownloadStatus:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.is_pause?"resume":"pause",t.next=3,$axios.get("download?method=".concat(a,"&id=").concat(e.LastID)).catch(this.error);case 3:s=t.sent,0===s.data.code?this.$Message.success("操作成功"):this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),cancelTask:function(t){var e=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var a=Object(c["a"])(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,$axios.get("download?method=cancel&id=".concat(t.LastID)).catch(e.error);case 2:s=a.sent,0===s.data.code?e.$Message.success("操作成功"):e.$Message.error({content:s.data.msg,duration:10,closable:!0});case 4:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}()})},getTaskStatus:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a,s,n,o,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("download?method=status&id=".concat(e)).catch(this.error);case 2:if(a=t.sent,0===a.data.code){for(this.taskDetail=[],s=a.data.data,n=0;n<s.length;n++)o="","<nil>"!==s[n].error&&(o=s[n].error),this.taskDetail.push({id:s[n].id,status:s[n].status,speed:m["a"].bytesToSize(s[n].speed),error:o});this.modalDetailFlag&&setTimeout(function(){return r.getTaskStatus(e)},1e3)}else this.$Message.info({content:a.data.msg,duration:10,closable:!0}),this.modalDetailFlag=!1;case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),detailTask:function(t){this.getTaskStatus(t.LastID),this.modalDetailFlag=!0}}},v=_,h=a("2877"),f=Object(h["a"])(v,d,p,!1,null,null,null);f.options.__file="DownloadProcessItem.vue";var g=f.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"child-finished"},t._l(t.items,function(e){return a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name)+"\n      "),a("Divider",{attrs:{type:"vertical"}}),a("span",[t._v(t._s(e.total_size))])],1),a("Row",[a("Col",{attrs:{span:"1"}},[a("Icon",{attrs:{type:"md-checkmark-circle",size:"24",color:"#19be6b"}})],1),a("Col",{attrs:{span:"20"}},[a("span",[t._v("平均速度: "+t._s(e.avg_speed)+"/s")]),a("Divider",{attrs:{type:"vertical"}}),a("span",[t._v("已用时间: "+t._s(e.time_used))]),a("Divider",{attrs:{type:"vertical"}}),1===t.itype?a("span",[t._v("保存本地")]):t._e(),2===t.itype?a("span",[t._v("保存云端")]):t._e(),t._v(" \n        "),a("span",[t._v("路径: "+t._s(e.save_path))]),a("Divider",{attrs:{type:"vertical"}}),1===t.itype?a("Button",{attrs:{type:"success",size:"small",ghost:""},on:{click:function(a){t.openFolder(e.save_path)}}},[a("Icon",{attrs:{type:"ios-redo"}}),t._v("打开下载目录\n        ")],1):t._e()],1)],1)],1)}))},y=[],b=(a("c5f6"),{name:"v-finished",props:{items:Array,itype:Number},methods:{openFolder:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("local_file?method=open_folder&path=".concat(encodeURIComponent(e))).catch(this.error);case 2:a=t.sent,0!==a.data.code&&this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),k=b,x=Object(h["a"])(k,w,y,!1,null,null,null);x.options.__file="Finished.vue";var S=x.exports,C=a("db49"),z=a("2f62"),D={name:"v-download",data:function(){return{select_menu_name:"1-1",base_url:C["a"].base_url,ws_url:C["a"].ws_url,modalDetailFlag:!1,offline_downloaded:[],offline_downloading:[]}},computed:Object(u["a"])({},Object(z["c"])(["globals","websocket"])),components:{VDownloadProcessItem:g,VFinished:S},methods:Object(u["a"])({},Object(z["b"])(["initWS"]),{initWebSocket:function(){null===this.websocket&&this.initWS()},getMenuName:function(t){this.select_menu_name=t,"3-1"!==t&&"3-2"!==t||this.getOfflineTask()},deleteTask:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a="delete",0!==e.status&&(a="cancel"),t.next=4,$axios.get("offline_download?method=".concat(a,"&id=").concat(e.taskid)).catch(this.error);case 4:s=t.sent,0===s.data.code?(this.$Message.success("删除成功"),this.getOfflineTask()):this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getOfflineTask:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,a,s,n,o,r,i,l=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("offline_download?method=list").catch(this.error);case 2:if(e=t.sent,0===e.data.code){for(a=e.data.data,s=[],n=[],o=0;o<a.length;o++)r=a[o],0===r.Status?s.push({taskid:r.TaskID,taskname:r.TaskName,status:r.Status,status_text:r.StatusText,file_size:m["a"].bytesToSize(r.FileSize),finished_size:m["a"].bytesToSize(r.FinishedSize),ftime:m["a"].formatDateTime(1e3*r.FinishTime),path:r.SavePath,url:r.SourceURL,type:r.OdType}):(i=(1*r.FinishedSize/(1*r.FileSize)*100).toFixed(2),n.push({taskid:r.TaskID,taskname:r.TaskName,status:r.Status,status_text:r.StatusText,file_size:m["a"].bytesToSize(r.FileSize),finished_size:m["a"].bytesToSize(r.FinishedSize),percent:1*i,stime:m["a"].formatDateTime(1e3*r.StartTime),path:r.SavePath,url:r.SourceURL,type:r.OdType}));this.offline_downloaded=s,this.offline_downloading=n,n.length>0&&setTimeout(function(){return l.getOfflineTask()},1e3)}else this.$Message.error({content:e.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),cancelAll:function(){var t=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var a,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=l(t.globals.downloading.map(function(t){return t.LastID})).concat(l(t.globals.pending_download.map(function(t){return t.LastID}))),n=0;case 2:if(!(n<a.length)){e.next=14;break}case 3:return e.next=5,m["a"].sleep();case 5:return e.next=7,$axios.get("download?method=cancel&id=".concat(a[n])).catch(t.error);case 7:s=e.sent;case 8:if(0!==s.data.code){e.next=3;break}case 9:return e.next=11,m["a"].sleep();case 11:n++,e.next=2;break;case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()})}}),created:function(){this.initWebSocket()}},T=D,I=Object(h["a"])(T,s,n,!1,null,null,null);I.options.__file="Download.vue";e["default"]=I.exports}}]);
//# sourceMappingURL=download.aca90027.js.map